% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/identify_optimal_alpha.R
\name{identify_optimal_alpha}
\alias{identify_optimal_alpha}
\title{Identify Optimal Alpha for SFI-Aware Calibration}
\usage{
identify_optimal_alpha(
  data,
  train_ratio = 0.7,
  high_fidelity_codes,
  specific_medications,
  alpha_range = seq(0.5, 2.5, by = 0.25),
  predictors = c("age", "race"),
  ntree = 500,
  seed = 123,
  verbose = TRUE
)
}
\arguments{
\item{data}{A data.frame containing patient-level longitudinal EHR data with columns:
\itemize{
\item \code{patient_id}: Unique patient identifier
\item \code{label}: Binary outcome (0/1)
\item \code{age}: Patient age
\item \code{race}: Patient race/ethnicity
\item \code{diagnosis_code}: ICD-10 diagnosis codes
\item \code{encounter_date}: Date of encounter
\item \code{setting}: Care setting (inpatient/outpatient)
\item \code{medication}: Medication prescriptions (semicolon-separated)
}}

\item{train_ratio}{Proportion of data to use for training (default = 0.7)}

\item{high_fidelity_codes}{Character vector of high-fidelity diagnosis codes for the phenotype}

\item{specific_medications}{Character vector of phenotype-specific medications}

\item{alpha_range}{Numeric vector of alpha values to test (default = seq(0.5, 2.5, by = 0.25))}

\item{predictors}{Character vector of predictor variables for random forest (default = c("age", "race"))}

\item{ntree}{Number of trees in random forest (default = 500)}

\item{seed}{Random seed for reproducibility (default = 123)}

\item{verbose}{Logical; print progress messages (default = TRUE)}
}
\value{
A list containing:
\itemize{
\item \code{optimal_alpha}: The selected optimal alpha value
\item \code{optimal_metrics}: Performance metrics at optimal alpha
\item \code{alpha_results}: Data.frame with performance across all alpha values
\item \code{model}: The trained random forest model
\item \code{train_data}: Training dataset with SFI scores
\item \code{test_data}: Test dataset with SFI scores and predictions
\item \code{sfi_reference}: Reference SFI mean from training data
\item \code{alpha_plot}: ggplot object showing alpha sensitivity
}
}
\description{
This function performs a comprehensive workflow to identify the optimal alpha parameter
for SFI-aware calibration on a given dataset. It splits data into training and testing sets,
trains a random forest model, computes SFI components, tests multiple alpha values,
and selects the optimal alpha based on the geometric mean of F1-score and Recall improvements.
}
\details{
The function implements the methodology described in the SFI-aware calibration paper:
\enumerate{
\item Splits data into training and testing sets at patient level
\item Aggregates patient-level data and trains random forest model
\item Computes SFI components for all patients
\item Tests multiple alpha values (0.5 to 2.5)
\item Selects optimal alpha by maximizing geometric mean of F1 and Recall improvements
\item Validates statistical significance (p < 0.05) of performance gains
}

The optimal alpha represents the calibration strength parameter that balances
prediction adjustment based on patient-level diagnostic fidelity.
}
\examples{
\dontrun{
# Load synthetic data
data <- read.csv("synthetic_data.csv")

# Define phenotype-specific parameters
high_fidelity_codes <- c("F90.0", "F90.1", "F90.2", "F90.8", "F90.9")
specific_medications <- c("methylphenidate", "amphetamine", "atomoxetine")

# Identify optimal alpha
results <- identify_optimal_alpha(
  data = data,
  train_ratio = 0.7,
  high_fidelity_codes = high_fidelity_codes,
  specific_medications = specific_medications,
  alpha_range = seq(0.5, 2.5, by = 0.25),
  seed = 123
)

# View results
print(results$optimal_alpha)
print(results$optimal_metrics)
plot(results$alpha_plot)
}

}
